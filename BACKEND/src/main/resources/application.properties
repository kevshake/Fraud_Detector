# Application Configuration
spring.application.name=aml-fraud-detector
server.port=${SERVER_PORT:2637}
server.servlet.context-path=${CONTEXT_PATH:/api/v1}

# Internationalization (i18n) Configuration
spring.messages.basename=messages/messages
spring.messages.encoding=UTF-8
spring.messages.fallback-to-system-locale=true
spring.messages.cache-duration=3600

# Default Locale
spring.web.locale=en
spring.web.locale-resolver=fixed

# Tomcat Thread Pool Configuration (Ultra High Throughput - 30K+ requests)
server.tomcat.threads.min-spare=${TOMCAT_MIN_SPARE:200}
server.tomcat.threads.max=${TOMCAT_MAX_THREADS:1000}
server.tomcat.max-connections=${TOMCAT_MAX_CONNECTIONS:10000}
server.tomcat.accept-count=${TOMCAT_ACCEPT_COUNT:5000}
server.tomcat.connection-timeout=${TOMCAT_CONNECTION_TIMEOUT:20000}
server.tomcat.keep-alive-timeout=${TOMCAT_KEEPALIVE_TIMEOUT:60000}
server.tomcat.max-keep-alive-requests=${TOMCAT_MAX_KEEPALIVE:1000}

# HTTP/2 Support - Dynamic Auto-Detection and Failover
server.http2.enabled=${HTTP2_ENABLED:false}

# HTTP/2 Auto-Detection Configuration
http2.auto.detect.enabled=${HTTP2_AUTO_DETECT_ENABLED:true}
http2.detection.test.url=${HTTP2_DETECTION_TEST_URL:http://localhost:8080/actuator/health}
http2.detection.timeout.ms=${HTTP2_DETECTION_TIMEOUT:5000}
http2.detection.refresh.interval.seconds=${HTTP2_DETECTION_REFRESH_INTERVAL:300}

# HTTP/2 Health Monitoring Configuration
http2.health.monitoring.enabled=${HTTP2_HEALTH_MONITORING_ENABLED:true}
http2.health.check.interval.seconds=${HTTP2_HEALTH_CHECK_INTERVAL:30}
http2.failover.drop.threshold=${HTTP2_FAILOVER_DROP_THRESHOLD:10}
http2.failover.error.rate.threshold=${HTTP2_FAILOVER_ERROR_RATE_THRESHOLD:0.05}
http2.failover.latency.threshold.ms=${HTTP2_FAILOVER_LATENCY_THRESHOLD:1000}

# HTTP/2 Failover Configuration
http2.failover.enabled=${HTTP2_FAILOVER_ENABLED:true}
http2.failover.retry.interval.seconds=${HTTP2_FAILOVER_RETRY_INTERVAL:300}
http2.failover.min.retry.interval.seconds=${HTTP2_FAILOVER_MIN_RETRY_INTERVAL:60}
http2.failover.auto.retry.enabled=${HTTP2_FAILOVER_AUTO_RETRY_ENABLED:true}

# HTTP/2 Network Stability Configuration (Background Process)
http2.network.stability.enabled=${HTTP2_NETWORK_STABILITY_ENABLED:true}
http2.network.stability.check.interval.seconds=${HTTP2_NETWORK_STABILITY_CHECK_INTERVAL:30}
http2.network.stability.test.url=${HTTP2_NETWORK_STABILITY_TEST_URL:http://localhost:8080/actuator/health}
http2.network.stability.timeout.ms=${HTTP2_NETWORK_STABILITY_TIMEOUT:5000}
http2.network.stability.success.threshold=${HTTP2_NETWORK_STABILITY_SUCCESS_THRESHOLD:5}
http2.network.stability.failure.threshold=${HTTP2_NETWORK_STABILITY_FAILURE_THRESHOLD:3}

# Compression
server.compression.enabled=${COMPRESSION_ENABLED:true}
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain
server.compression.min-response-size=1024

# SpringDoc OpenAPI (Swagger) Configuration
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=${SWAGGER_UI_ENABLED:true}
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
springdoc.swagger-ui.filter=true
springdoc.swagger-ui.displayRequestDuration=true
springdoc.swagger-ui.showExtensions=true
springdoc.swagger-ui.showCommonExtensions=true
springdoc.swagger-ui.disable-swagger-default-url=true
springdoc.swagger-ui.config-url=/api-docs/swagger-config
springdoc.swagger-ui.validator-url=
springdoc.default-consumes-media-type=application/json
springdoc.default-produces-media-type=application/json
springdoc.paths-to-match=/api/v1/**
springdoc.packages-to-scan=com.posgateway.aml.controller
springdoc.show-actuator=false

# =============================================================================
# Database Configuration
# =============================================================================
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/aml_fraud_db}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:Tr13com012009!}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${HIBERNATE_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${HIBERNATE_FORMAT_SQL:true}
# Ensure JPA waits for Flyway to complete migrations
spring.jpa.defer-datasource-initialization=false

# Hibernate Envers Configuration
spring.jpa.properties.hibernate.envers.store_data_at_delete=false

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=false
spring.flyway.locations=classpath:db/migration
spring.flyway.encoding=UTF-8
spring.flyway.detect-encoding=true
spring.flyway.fail-on-missing-locations=true

# Database Query Logging (for performance optimization)
spring.jpa.properties.hibernate.show_sql=${HIBERNATE_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${HIBERNATE_FORMAT_SQL:true}
spring.jpa.properties.hibernate.use_sql_comments=${HIBERNATE_USE_SQL_COMMENTS:true}
logging.level.org.hibernate.SQL=${HIBERNATE_SQL_LOG_LEVEL:WARN}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${HIBERNATE_BINDER_LOG_LEVEL:WARN}
# Suppress Hibernate Envers metamodel warning (HHH015007) - known compatibility issue, doesn't affect functionality
logging.level.org.hibernate.metamodel.internal.MetadataContext=ERROR
spring.jpa.properties.hibernate.generate_statistics=${HIBERNATE_STATISTICS:false}
spring.jpa.properties.hibernate.session.events.log.LOG_QUERIES_SLOWER_THAN_MS=${SLOW_QUERY_THRESHOLD:1000}

# =============================================================================
# Neo4j Graph Database Configuration (Community Edition)
# =============================================================================
neo4j.enabled=${NEO4J_ENABLED:false}
spring.neo4j.uri=${NEO4J_URI:bolt://localhost:7687}
spring.neo4j.authentication.username=${NEO4J_USER:neo4j}
spring.neo4j.authentication.password=${NEO4J_PASSWORD:password}
spring.data.neo4j.database=${NEO4J_DATABASE:neo4j}

# =============================================================================
# Aerospike Configuration (Production Best Practices)
# =============================================================================
aerospike.enabled=${AEROSPIKE_ENABLED:true}
aerospike.hosts=${AEROSPIKE_HOSTS:localhost:3000}
aerospike.namespace=${AEROSPIKE_NAMESPACE:test}
aerospike.timeoutMs=${AEROSPIKE_TIMEOUT_MS:1000}

# Aerospike Authentication (optional - leave empty for no auth)
aerospike.user=${AEROSPIKE_USER:}
aerospike.password=${AEROSPIKE_PASSWORD:}

# Connection & Performance Tuning
aerospike.maxConnsPerNode=${AEROSPIKE_MAX_CONNS_PER_NODE:300}
aerospike.connPoolsPerNode=${AEROSPIKE_CONN_POOLS_PER_NODE:1}
aerospike.failIfNotConnected=${AEROSPIKE_FAIL_IF_NOT_CONNECTED:false}
aerospike.tendInterval=${AEROSPIKE_TEND_INTERVAL:1000}

# Retry Policy
aerospike.maxRetries=${AEROSPIKE_MAX_RETRIES:1}
aerospike.sleepBetweenRetries=${AEROSPIKE_SLEEP_BETWEEN_RETRIES:0}

# TTL Handling (default cache expiration in seconds)
aerospike.cache.default.ttl.seconds=${AEROSPIKE_DEFAULT_TTL:3600}

# =============================================================================
# Sumsub KYC Configuration

# =============================================================================
sumsub.enabled=${SUMSUB_ENABLED:false}
sumsub.api.url=${SUMSUB_API_URL:https://api.sumsub.com/resources}
sumsub.api.key=${SUMSUB_API_KEY:dev-placeholder-key}
sumsub.api.secret=${SUMSUB_API_SECRET:dev-placeholder-secret}
sumsub.cost.per.check=${SUMSUB_COST_PER_CHECK:1.85}

# =============================================================================
# Sanctions Screening Configuration
# =============================================================================
# Sanctions Download
sanctions.download.enabled=${SANCTIONS_DOWNLOAD_ENABLED:false}
sanctions.opensanctions.url=${SANCTIONS_OPENSANCTIONS_URL:https://api.opensanctions.org/datasets/latest/default/entities.json}
sanctions.opensanctions.metadata.url=${SANCTIONS_OPENSANCTIONS_METADATA_URL:https://api.opensanctions.org/datasets/latest/default/index.json}

# Name Matching Thresholds
sanctions.matching.levenshtein.threshold=${SANCTIONS_LEVENSHTEIN_THRESHOLD:3}
sanctions.matching.similarity.threshold=${SANCTIONS_SIMILARITY_THRESHOLD:0.8}

# Real-time Screening
screening.realtime.enabled=${SCREENING_REALTIME_ENABLED:true}
screening.realtime.block-on-match=${SCREENING_BLOCK_ON_MATCH:true}
screening.realtime.screen-merchant=${SCREENING_SCREEN_MERCHANT:true}
screening.realtime.screen-counterparty=${SCREENING_SCREEN_COUNTERPARTY:false}

# Periodic Rescreening
rescreening.enabled=${RESCREENING_ENABLED:true}
rescreening.frequency.days=${RESCREENING_FREQUENCY_DAYS:7}

# =============================================================================
# KYC Configuration
# =============================================================================
# KYC Expiration Tracking
kyc.expiration.alert-days=${KYC_EXPIRATION_ALERT_DAYS:30}
kyc.expiration.critical-days=${KYC_EXPIRATION_CRITICAL_DAYS:7}

# Periodic KYC Refresh (by risk level)
kyc.refresh.enabled=${KYC_REFRESH_ENABLED:true}
kyc.refresh.high-risk.days=${KYC_REFRESH_HIGH_RISK_DAYS:90}
kyc.refresh.medium-risk.days=${KYC_REFRESH_MEDIUM_RISK_DAYS:180}
kyc.refresh.low-risk.days=${KYC_REFRESH_LOW_RISK_DAYS:365}

# Trigger-based KYC
kyc.trigger.large-transaction.threshold=${KYC_TRIGGER_LARGE_TXN_THRESHOLD:50000}
kyc.trigger.risk-change.enabled=${KYC_TRIGGER_RISK_CHANGE_ENABLED:true}

# =============================================================================
# Risk Scoring Configuration
# =============================================================================
# Enhanced Due Diligence (EDD) Threshold
risk.edd.threshold=${RISK_EDD_THRESHOLD:0.7}

# High-value Transaction Threshold
risk.high-value.threshold=${RISK_HIGH_VALUE_THRESHOLD:50000}

# Merchant Onboarding Risk Thresholds
risk.threshold.approve=${RISK_THRESHOLD_APPROVE:30}
risk.threshold.review=${RISK_THRESHOLD_REVIEW:50}
risk.threshold.reject=${RISK_THRESHOLD_REJECT:80}

# High-risk MCC Codes (comma-separated)
risk.mcc.high_risk=${RISK_MCC_HIGH_RISK:6211,7995,7273,5993,6051}

# =============================================================================
# Scoring Service Configuration
# =============================================================================
scoring.service.enabled=${SCORING_SERVICE_ENABLED:true}
scoring.service.url=${SCORING_SERVICE_URL:http://localhost:8000}
scoring.service.retry.max=${SCORING_SERVICE_RETRY_MAX:3}
scoring.cache.enabled=${SCORING_CACHE_ENABLED:true}

# =============================================================================
# HTTP Client Configuration
# =============================================================================
http.connection.timeout=${HTTP_CONNECTION_TIMEOUT:5000}
http.socket.timeout=${HTTP_SOCKET_TIMEOUT:10000}
http.connection.request.timeout=${HTTP_CONNECTION_REQUEST_TIMEOUT:5000}

# =============================================================================
# Ultra High Throughput Configuration
# =============================================================================
ultra.throughput.max.requests.per.second=${ULTRA_THROUGHPUT_MAX_RPS:50000}
ultra.throughput.max.concurrent.requests=${ULTRA_THROUGHPUT_MAX_CONCURRENT:30000}
ultra.throughput.request.buffer.size=${ULTRA_THROUGHPUT_BUFFER_SIZE:50000}
ultra.throughput.batch.processing.size=${ULTRA_THROUGHPUT_BATCH_SIZE:500}

# Parallel Feature Extraction
throughput.parallel.feature.extraction=${THROUGHPUT_PARALLEL_FEATURE_EXTRACTION:true}

# =============================================================================
# Transaction Statistics Configuration
# =============================================================================
transaction.stats.key.prefix=${TRANSACTION_STATS_KEY_PREFIX:aml:stats}
transaction.stats.ttl.hours=${TRANSACTION_STATS_TTL_HOURS:168}

# =============================================================================
# Regulatory Reporting Configuration
# =============================================================================
# Currency Transaction Report (CTR) Threshold
regulatory.ctr.threshold=${REGULATORY_CTR_THRESHOLD:10000}

# Large Currency Transaction Report (LCTR) Threshold
regulatory.lctr.threshold=${REGULATORY_LCTR_THRESHOLD:100000}

# =============================================================================
# Monitoring & Alerting Configuration
# =============================================================================
# G2 Content Monitoring
g2.monitoring.enabled=${G2_MONITORING_ENABLED:true}

# Slack Integration
slack.enabled=${SLACK_ENABLED:false}
slack.webhook.url=${SLACK_WEBHOOK_URL:}

# =============================================================================
# External Services Configuration
# =============================================================================
# VGS Proxy (for PCI compliance)
vgs.proxy.enabled=${VGS_PROXY_ENABLED:false}

# =============================================================================
# Security Configuration
# =============================================================================
# Encryption Key (use environment variable in production)
security.encryption.key=${SECURITY_ENCRYPTION_KEY:}

# PII Masking (override in dev profile)
security.pii.masking.enabled=${SECURITY_PII_MASKING_ENABLED:true}

# =============================================================================
# Kafka Configuration
# =============================================================================
# Kafka is always enabled - required for case event processing
kafka.enabled=${KAFKA_ENABLED:true}
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.admin.auto-create=false
spring.kafka.admin.fail-fast=false

# Kafka Consumer Configuration
spring.kafka.consumer.group-id=${KAFKA_CONSUMER_GROUP_ID:aml-case-group}
spring.kafka.consumer.auto-offset-reset=${KAFKA_AUTO_OFFSET_RESET:earliest}
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer

# Kafka Producer Configuration
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer

# Kafka Connection Retry Configuration
spring.kafka.consumer.properties.max.poll.interval.ms=${KAFKA_MAX_POLL_INTERVAL:300000}
spring.kafka.consumer.properties.session.timeout.ms=${KAFKA_SESSION_TIMEOUT:30000}

# Reconnect Backoff Configuration - Reduces frequency of connection attempts when broker is unavailable
# Base time to wait before reconnecting (default: 50ms - too aggressive)
spring.kafka.consumer.properties.reconnect.backoff.ms=${KAFKA_RECONNECT_BACKOFF_MS:1000}
# Maximum time to wait when reconnecting (default: 1000ms)
spring.kafka.consumer.properties.reconnect.backoff.max.ms=${KAFKA_RECONNECT_BACKOFF_MAX_MS:10000}

# Retry Backoff Configuration - Controls retry frequency for failed requests
# Initial time to wait before retrying failed request (default: 100ms)
spring.kafka.consumer.properties.retry.backoff.ms=${KAFKA_RETRY_BACKOFF_MS:1000}
# Maximum time to wait when retrying (default: 1000ms)
spring.kafka.consumer.properties.retry.backoff.max.ms=${KAFKA_RETRY_BACKOFF_MAX_MS:5000}

# Request Timeout - Time to wait for a response from broker
spring.kafka.consumer.properties.request.timeout.ms=${KAFKA_REQUEST_TIMEOUT_MS:30000}

# Metadata Configuration - Controls how often to refresh broker metadata
spring.kafka.consumer.properties.metadata.max.age.ms=${KAFKA_METADATA_MAX_AGE_MS:300000}

# Suppress Kafka connection warnings when broker is temporarily unavailable
# These warnings are expected during startup or when broker is down and will resolve once broker is available
logging.level.org.apache.kafka.clients.NetworkClient=WARN
logging.level.org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient=WARN

# =============================================================================
# Actuator & Prometheus Configuration
# =============================================================================
# Expose actuator endpoints for monitoring
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
# Base path for actuator endpoints (defaults to /actuator)
management.endpoints.web.base-path=/actuator
# Enable all endpoints (can be restricted in production)
management.endpoints.enabled-by-default=true
# Metrics collection configuration
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=${spring.profiles.active:default}
# Prometheus specific configuration
management.metrics.export.prometheus.step=10s
