groups:
  - name: aml_fraud_detector_alerts
    interval: 30s
    rules:
      # High Error Rate Alert
      - alert: HighErrorRate
        expr: rate(api_errors_total[5m]) > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High API error rate detected"
          description: "Error rate is {{ $value }} errors/sec for the last 5 minutes"

      # High Transaction Processing Time
      - alert: HighTransactionProcessingTime
        expr: histogram_quantile(0.95, rate(aml_transactions_processing_time_bucket[5m])) > 1000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High transaction processing time"
          description: "P95 transaction processing time is {{ $value }}ms"

      # High Fraud Detection Rate
      - alert: HighFraudDetectionRate
        expr: rate(fraud_detected_total[5m]) / rate(fraud_assessments_total[5m]) > 0.1
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "High fraud detection rate"
          description: "Fraud detection rate is {{ $value | humanizePercentage }}"

      # High AML Risk Rate
      - alert: HighAMLRiskRate
        expr: rate(aml_risk_high_total[5m]) / rate(aml_risk_assessments_total[5m]) > 0.05
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High AML risk rate detected"
          description: "High risk AML assessments are {{ $value | humanizePercentage }} of total"

      # Model Performance Degradation
      - alert: ModelPerformanceDegradation
        expr: model_auc < 0.7
        for: 30m
        labels:
          severity: critical
        annotations:
          summary: "Model performance degradation"
          description: "Model AUC has dropped to {{ $value }}"

      # High Model Drift
      - alert: HighModelDrift
        expr: model_drift_score > 0.2
        for: 30m
        labels:
          severity: warning
        annotations:
          summary: "High model drift detected"
          description: "Model drift score is {{ $value }}"

      # Compliance Cases Backlog
      - alert: ComplianceCasesBacklog
        expr: compliance_open_cases > 100
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "High number of open compliance cases"
          description: "There are {{ $value }} open compliance cases"

      # Pending SARs Alert
      - alert: PendingSARsAlert
        expr: compliance_pending_sars > 20
        for: 1h
        labels:
          severity: critical
        annotations:
          summary: "High number of pending SARs"
          description: "There are {{ $value }} pending SARs that need attention"

      # Low Cache Hit Rate
      - alert: LowCacheHitRate
        expr: (sum(rate(cache_hits_total[5m])) / (sum(rate(cache_hits_total[5m])) + sum(rate(cache_misses_total[5m])))) < 0.7
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: "Low cache hit rate"
          description: "Cache hit rate is {{ $value | humanizePercentage }}"

      # High JVM Memory Usage
      - alert: HighJVMMemoryUsage
        expr: (jvm_memory_used_bytes / jvm_memory_max_bytes) > 0.9
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High JVM memory usage"
          description: "JVM memory usage is {{ $value | humanizePercentage }}"

      # Database Connection Pool Exhaustion
      - alert: DatabaseConnectionPoolExhaustion
        expr: (database_connection_pool_active / database_connection_pool_size) > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Database connection pool near exhaustion"
          description: "{{ $value | humanizePercentage }} of connection pool is in use"

      # High Screening Queue Size
      - alert: HighScreeningQueueSize
        expr: screening_queue_size > 500
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High screening queue size"
          description: "Screening queue has {{ $value }} items"

      # Transaction Queue Backlog
      - alert: TransactionQueueBacklog
        expr: aml_transactions_queue_size > 1000
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "Transaction queue backlog"
          description: "Transaction queue has {{ $value }} items"

