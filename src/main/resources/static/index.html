<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AML Fraud Detector - Admin Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/case-management.css">
    <link rel="stylesheet" href="css/session-management.css">
    <link rel="stylesheet" href="css/limits-aml-management.css">
    <link rel="stylesheet" href="css/transaction-monitoring.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <!-- Leaflet.js for map visualization -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shield-halved logo-icon"></i>
            <span class="logo-text">AML Detector</span>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </a>
                <div class="nav-submenu show">
                    <a href="#" class="nav-subitem" data-view="dashboard">Overview</a>
                    <a href="#" class="nav-subitem active" data-view="dashboard">Analytics</a>
                    <a href="#" class="nav-subitem" data-view="dashboard">Widgets</a>
                </div>
            </div>

            <div class="nav-section">
                <a href="#" class="nav-item" data-view="cases">
                    <i class="fas fa-folder-open"></i>
                    <span>Cases</span>
                    <span class="badge badge-warning" id="cases-count-badge">0</span>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </a>
                <div class="nav-submenu">
                    <a href="#" class="nav-subitem" data-view="cases">All Cases</a>
                    <a href="#" class="nav-subitem" data-view="case-timeline">Timeline</a>
                    <a href="#" class="nav-subitem" data-view="case-network">Network Graph</a>
                    <a href="#" class="nav-subitem" data-view="case-queues">Queues</a>
                </div>
            </div>

            <a href="#" class="nav-item" data-view="sar">
                <i class="fas fa-file-alt"></i>
                <span>SAR Reports</span>
                <span class="badge badge-danger" id="sar-count-badge">0</span>
            </a>

            <a href="#" class="nav-item" data-view="alerts">
                <i class="fas fa-bell"></i>
                <span>Alerts</span>
                <span class="badge badge-info" id="alerts-count-badge">0</span>
            </a>

            <a href="#" class="nav-item" data-view="risk-analytics">
                <i class="fas fa-chart-line"></i>
                <span>Risk Analytics</span>
            </a>

            <a href="#" class="nav-item" data-view="compliance-calendar">
                <i class="fas fa-calendar-alt"></i>
                <span>Compliance Calendar</span>
            </a>

            <a href="#" class="nav-item" data-view="regulatory-reports">
                <i class="fas fa-file-invoice"></i>
                <span>Regulatory Reports</span>
            </a>

            <a href="#" class="nav-item" data-view="merchants">
                <i class="fas fa-building"></i>
                <span>Merchants</span>
            </a>

            <div class="nav-section">
                <a href="#" class="nav-item" data-view="transaction-monitoring">
                    <i class="fas fa-eye"></i>
                    <span>Transaction Monitoring</span>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </a>
                <div class="nav-submenu">
                    <a href="#" class="nav-subitem" data-view="transaction-monitoring-live">Live Monitoring</a>
                    <a href="#" class="nav-subitem" data-view="transaction-monitoring-analytics">Analytics</a>
                    <a href="#" class="nav-subitem" data-view="transaction-monitoring-sars">SARs</a>
                    <a href="#" class="nav-subitem" data-view="transaction-monitoring-reports">Reports</a>
                </div>
            </div>

            <a href="#" class="nav-item" data-view="screening">
                <i class="fas fa-search"></i>
                <span>Screening</span>
            </a>

            <a href="#" class="nav-item" data-view="profile">
                <i class="fas fa-user-circle"></i>
                <span>Profile</span>
            </a>

            <a href="#" class="nav-item" data-view="messages">
                <i class="fas fa-envelope"></i>
                <span>Messages</span>
                <span class="badge badge-primary" id="messages-count-badge">0</span>
            </a>

            <div class="nav-divider"></div>
            <span class="nav-label">ADMINISTRATION</span>

            <a href="#" class="nav-item" data-view="settings">
                <i class="fas fa-cogs"></i>
                <span>Settings</span>
            </a>

            <a href="#" class="nav-item" data-view="users">
                <i class="fas fa-users"></i>
                <span>User Management</span>
            </a>

            <a href="#" class="nav-item" data-view="roles">
                <i class="fas fa-user-tag"></i>
                <span>Role Management</span>
            </a>

            <a href="#" class="nav-item" data-view="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
            </a>

            <a href="#" class="nav-item" data-view="audit">
                <i class="fas fa-history"></i>
                <span>Audit Logs</span>
            </a>

            <a href="#" class="nav-item" data-view="limits-aml">
                <i class="fas fa-sliders-h"></i>
                <span>Limits & AML</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Header -->
        <header class="top-header">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search Dashboard">
            </div>

            <div class="header-actions">
                <!-- Session Status Indicator -->
                <div class="session-status-indicator" id="sessionStatusIndicator" style="display: none;">
                    <i class="fas fa-circle" id="sessionStatusIcon"></i>
                    <span id="sessionStatusText">Session Active</span>
                </div>

                <div class="user-profile" id="userProfileTrigger">
                    <img src="https://ui-avatars.com/api/?name=Super+Admin&background=6c5ce7&color=fff" alt="Admin">
                    <span>super.admin@aml.com</span>
                    <i class="fas fa-chevron-down"></i>

                    <div class="profile-dropdown" id="profileDropdown">
                        <a href="#" data-view="profile"><i class="fas fa-user-circle"></i> My Profile</a>
                        <a href="#" data-view="settings"><i class="fas fa-cog"></i> Settings</a>
                        <div class="dropdown-divider"></div>
                        <a href="logout" class="logout-link" onclick="handleLogout(event)"><i
                                class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard View -->
        <div id="dashboard-view">
            <!-- Page Title -->
            <div class="page-header">
                <h1>Analytics <span class="subtitle">Fraud Detection Performance</span></h1>
            </div>

            <!-- Stats Row -->
            <!-- Stats Row -->
            <div class="stats-grid analytics-top-row">
                <div class="stat-card">
                    <div class="stat-header">
                        <span>Total Merchants</span>
                    </div>
                    <div class="stat-value" id="totalMerchants">0</div>
                    <div class="stat-subtext" id="totalMerchantsTrend">+0 this month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span>Active Merchants</span>
                    </div>
                    <div class="stat-value" id="activeMerchants">0</div>
                    <div class="stat-subtext" id="activeMerchantsPercent">0% of total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span>High Risk</span>
                    </div>
                    <div class="stat-value" id="highRiskMerchants">0</div>
                    <div class="stat-subtext">Requires monitoring</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span>Total Volume</span>
                    </div>
                    <div class="stat-value" id="totalVolume">$0</div>
                    <div class="stat-subtext" id="totalVolumeTrend">+0% from last month</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span>Risk Breakdown</span>
                        <button class="close-btn">&times;</button>
                    </div>
                    <div class="chart-container">
                        <canvas id="riskPieChart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><i class="fas fa-square" style="color: #e74c3c;"></i> High</span>
                        <span class="legend-item"><i class="fas fa-square" style="color: #f39c12;"></i> Medium</span>
                        <span class="legend-item"><i class="fas fa-square" style="color: #27ae60;"></i> Low</span>
                    </div>
                </div>
            </div>

            <!-- Horizontal Cards Row -->
            <div class="stats-grid horizontal-cards-row">
                <div class="stat-card">
                    <div class="stat-header">
                        <span>SAR Performance</span>
                        <button class="close-btn">&times;</button>
                    </div>
                    <div class="progress-stats">
                        <div class="progress-item">
                            <span class="label"><i class="fas fa-circle" style="color: #27ae60;"></i> Filed</span>
                            <span class="value">78%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar filed" style="width: 78%;"></div>
                        </div>
                        <div class="progress-item">
                            <span class="label"><i class="fas fa-circle" style="color: #3498db;"></i> Pending
                                Review</span>
                            <span class="value">22%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar pending" style="width: 22%;"></div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span>Sanctions Status</span>
                    </div>
                    <div class="system-stats">
                        <div class="system-stat">
                            <span class="value" id="lastSanctionsRun">-</span>
                            <span class="label">Last Run</span>
                        </div>
                        <div class="system-stat">
                            <span class="value" id="sanctionsRunStatus">-</span>
                            <span class="label">Status</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span>Fraud Metrics</span>
                    </div>
                    <div class="system-stats">
                        <div class="system-stat">
                            <span class="value" id="metricPrecision">-</span>
                            <span class="label">Precision</span>
                        </div>
                        <div class="system-stat">
                            <span class="value" id="metricRecall">-</span>
                            <span class="label">Recall</span>
                        </div>
                        <div class="system-stat">
                            <span class="value" id="metricF1">-</span>
                            <span class="label">F1 Score</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span>System Health</span>
                    </div>
                    <div class="system-stats">
                        <div class="system-stat">
                            <span class="value">99.9%</span>
                            <span class="label">Uptime</span>
                        </div>
                        <div class="system-stat">
                            <span class="value">1.2ms</span>
                            <span class="label">Response</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row (inside dashboard-view) -->
            <div class="charts-grid">
                <div class="chart-card wide">
                    <div class="card-header">
                        <h3>Daily <strong>Transaction Volume</strong></h3>
                        <div class="chart-tabs">
                            <button class="tab active">All</button>
                            <button class="tab">Flagged</button>
                            <button class="tab">Approved</button>
                        </div>
                        <div class="card-actions">
                            <button><i class="fas fa-chevron-down"></i></button>
                            <button>&times;</button>
                        </div>
                    </div>
                    <div class="line-chart-container">
                        <canvas id="transactionChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="card-header">
                        <h3>Case <strong>Aging Heatmap</strong></h3>
                        <div class="card-actions">
                            <button>&times;</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="caseAgingHeatmapChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="card-header">
                        <h3>Alert <strong>Disposition Rates</strong></h3>
                        <div class="card-actions">
                            <button>&times;</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="alertDispositionChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card wide">
                    <div class="card-header">
                        <h3>Geographic <strong>Risk Heatmap</strong></h3>
                        <div class="card-actions">
                            <select id="geographicRiskPeriod" style="margin-right: 10px; padding: 5px; background: var(--card-bg-color); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 4px;">
                                <option value="30">Last 30 Days</option>
                                <option value="90" selected>Last 90 Days</option>
                                <option value="180">Last 180 Days</option>
                                <option value="365">Last Year</option>
                            </select>
                            <button>&times;</button>
                        </div>
                    </div>
                    <div class="chart-container" style="height: 500px; position: relative;">
                        <div id="geographicRiskMap" style="width: 100%; height: 100%; border-radius: 8px;"></div>
                        <div id="geographicRiskLegend" class="map-legend"></div>
                    </div>
                </div>
            </div>

            <!-- Cases summary card could go here, but I'll leave it out for a cleaner dashboard for now -->

            <!-- Alerts Section -->
            <div class="alerts-grid">
                <div class="alert-card">
                    <div class="card-header">
                        <h3><i class="fas fa-bell"></i> Live Alerts</h3>
                        <span class="live-indicator"><i class="fas fa-circle"></i> Live</span>
                    </div>
                    <div class="alerts-list">
                        <div class="alert-item high">
                            <div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="alert-content">
                                <strong>High-Risk Transaction Detected</strong>
                                <p>Unusual pattern from Merchant #4521 - $45,000 transfer</p>
                                <span class="alert-time">2 minutes ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="activity-card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Recent Activity</h3>
                    </div>
                    <div class="activity-timeline">
                        <div class="activity-item">
                            <div class="activity-dot"></div>
                            <div class="activity-content">
                                <span class="activity-user">John Smith</span> assigned case CASE-2024-1247
                                <span class="activity-time">10m ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management View -->
        <div id="user-management-view" style="display: none;">
            <div class="page-header">
                <h1>User Management <span class="subtitle">Manage System and PSP Users</span></h1>
                <div class="header-actions">
                    <button class="btn-primary" onclick="openAddUserModal()"><i class="fas fa-plus"></i> Add
                        User</button>
                </div>
            </div>

            <div class="table-card">
                <table class="data-table" id="users-table">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>PSP</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Cases View -->
        <div id="cases-view" style="display: none;">
            <div class="page-header">
                <h1>Compliance Cases <span class="subtitle">Active Investigations</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="refreshCases()"><i class="fas fa-sync"></i> Refresh</button>
                    <button class="btn-primary" onclick="openCaseFilters()"><i class="fas fa-filter"></i>
                        Filter</button>
                </div>
            </div>

            <!-- Case Stats Cards -->
            <div class="stat-card" style="display: inline-block; width: 24%; margin-right: 1%;">
                <div class="stat-header"><span>Open Cases</span></div>
                <div class="stat-value" id="openCasesCount">0</div>
            </div>
            <div class="stat-card" style="display: inline-block; width: 24%; margin-right: 1%;">
                <div class="stat-header"><span>Overdue SLA</span></div>
                <div class="stat-value" id="overdueCasesCount" style="color: #e74c3c;">0</div>
            </div>
            <div class="stat-card" style="display: inline-block; width: 24%; margin-right: 1%;">
                <div class="stat-header"><span>Escalated</span></div>
                <div class="stat-value" id="escalatedCasesCount" style="color: #f39c12;">0</div>
            </div>
            <div class="stat-card" style="display: inline-block; width: 24%;">
                <div class="stat-header"><span>Unassigned</span></div>
                <div class="stat-value" id="unassignedCasesCount" style="color: #3498db;">0</div>
            </div>

            <div class="table-card">
                <div class="card-header">
                    <h3><i class="fas fa-folder-open"></i> All Cases</h3>
                    <div class="card-actions">
                        <select id="caseStatusFilter" onchange="filterCases()">
                            <option value="">All Status</option>
                            <option value="NEW">New</option>
                            <option value="ASSIGNED">Assigned</option>
                            <option value="IN_PROGRESS">In Progress</option>
                            <option value="ESCALATED">Escalated</option>
                            <option value="CLOSED_CLEARED">Closed</option>
                        </select>
                    </div>
                </div>
                <table class="data-table" id="cases-table">
                    <thead>
                        <tr>
                            <th>Case ID</th>
                            <th>Merchant</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Assigned To</th>
                            <th>SLA Deadline</th>
                            <th>Days Open</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Case Queues View -->
        <div id="case-queues-view" style="display: none;">
            <div class="page-header">
                <h1>Work Queues <span class="subtitle">Specialized Inspection Buckets</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="loadCaseQueuesView()"><i class="fas fa-sync"></i> Refresh</button>
                    <button class="btn-secondary" onclick="exportCaseQueuesCsv()"><i class="fas fa-file-csv"></i> Export CSV</button>
                    <button class="btn-primary" onclick="openCreateQueueModal()"><i class="fas fa-plus"></i> Create Queue</button>
                </div>
            </div>
            <div class="stats-grid" id="case-queues-stats">
                <div class="stat-card">
                    <div class="stat-header"><span>Total Queues</span></div>
                    <div class="stat-value" id="queuesTotal">0</div>
                    <div class="stat-subtext">Configured queues</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Enabled</span></div>
                    <div class="stat-value" id="queuesEnabled">0</div>
                    <div class="stat-subtext">Accepting cases</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Auto-Assign</span></div>
                    <div class="stat-value" id="queuesAutoAssign">0</div>
                    <div class="stat-subtext">Queues with auto assignment</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Queued Cases</span></div>
                    <div class="stat-value" id="queuesQueuedCases">0</div>
                    <div class="stat-subtext">Cases waiting in queues</div>
                </div>
            </div>
            <div class="table-card">
                <table class="data-table" id="case-queues-table">
                    <thead>
                        <tr>
                            <th>Queue</th>
                            <th>Target Role</th>
                            <th>Min Priority</th>
                            <th>Max Size</th>
                            <th>Auto Assign</th>
                            <th>Enabled</th>
                            <th>Queued (NEW)</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>



        <!-- Case Timeline View -->
        <div id="case-timeline-view" style="display: none;">
            <div class="page-header">
                <h1>Case Timeline <span class="subtitle">Chronological Event View</span></h1>
                <div class="header-actions">
                    <select id="timeline-case-selector" class="form-control" style="width: 250px; margin-right: 10px;">
                        <option value="">Select a case...</option>
                    </select>
                    <select id="timeline-filter-type" class="form-control" style="width: 200px; margin-right: 10px;">
                        <option value="">All Event Types</option>
                        <option value="CASE_CREATED">Case Created</option>
                        <option value="CASE_ASSIGNED">Assignments</option>
                        <option value="CASE_STATUS_CHANGED">Status Changes</option>
                        <option value="NOTE">Notes</option>
                        <option value="EVIDENCE_ATTACHED">Evidence</option>
                        <option value="TRANSACTION">Transactions</option>
                        <option value="SAR_CREATED">SAR Created</option>
                        <option value="SAR_APPROVED">SAR Approved</option>
                        <option value="SAR_FILED">SAR Filed</option>
                        <option value="ESCALATION">Escalations</option>
                        <option value="CASE_RESOLVED">Resolutions</option>
                    </select>
                    <button class="btn-primary" onclick="loadCaseTimeline()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="timeline-wrapper">
                <div class="timeline-case-info" id="timeline-case-info" style="display: none;">
                    <div class="case-info-card">
                        <h3 id="timeline-case-reference">-</h3>
                        <p id="timeline-case-description">-</p>
                        <div class="case-meta">
                            <span id="timeline-case-status">-</span>
                            <span id="timeline-case-priority">-</span>
                            <span id="timeline-case-assigned">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="timeline-container" id="timeline-container">
                    <div class="timeline-empty-state">
                        <i class="fas fa-clock"></i>
                        <p>Select a case to view its timeline</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Case Network Graph View -->
        <div id="case-network-view" style="display: none;">
            <div class="page-header">
                <h1>Case Network Graph <span class="subtitle">Relationship Visualization</span></h1>
                <div class="header-actions">
                    <select id="network-case-selector" class="form-control" style="width: 250px; margin-right: 10px;">
                        <option value="">Select a case...</option>
                    </select>
                    <input type="number" id="network-depth" value="2" min="1" max="5" style="width: 80px; margin-right: 10px;">
                    <label>Depth</label>
                    <button class="btn-primary" onclick="loadNetworkGraph()"><i class="fas fa-sync"></i>
                        Refresh</button>
                    <button class="btn-secondary" onclick="resetNetworkView()"><i class="fas fa-expand"></i>
                        Reset View</button>
                    <input type="text" id="network-search" placeholder="Search node..." style="width: 200px; margin-left: 10px;">
                    <button class="btn-secondary btn-sm" onclick="findNetworkNode()"><i class="fas fa-search"></i> Find</button>
                    <button class="btn-secondary btn-sm" id="network-physics-toggle-btn" onclick="toggleNetworkPhysics()">
                        <i class="fas fa-atom"></i> Physics: On
                    </button>
                    <button class="btn-secondary btn-sm" onclick="exportNetworkGraphPng()"><i class="fas fa-image"></i> PNG</button>
                </div>
            </div>
            
            <div class="network-graph-wrapper">
                <div class="network-legend" id="network-legend">
                    <h3>Legend</h3>
                    <div class="legend-item">
                        <div class="legend-color case-color"></div>
                        <span>Case</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color transaction-color"></div>
                        <span>Transaction</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color sar-color"></div>
                        <span>SAR</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color merchant-color"></div>
                        <span>Merchant</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color user-color"></div>
                        <span>User</span>
                    </div>
                </div>
                
                <div class="network-graph-container" id="network-graph-container">
                    <div class="network-loading" id="network-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading network graph...</p>
                    </div>
                    <div id="network-canvas"></div>
                </div>
                
                <div class="network-info-panel" id="network-info-panel" style="display: none;">
                    <h3>Node Details</h3>
                    <div id="network-node-details"></div>
                </div>
            </div>
        </div>

        <!-- Risk Analytics View -->
        <div id="risk-analytics-view" style="display: none;">
            <div class="page-header">
                <h1>Risk Analytics <span class="subtitle">Risk Heatmaps & Trends</span></h1>
                <div class="header-actions">
                    <select id="risk-analytics-period">
                        <option value="7">Last 7 Days</option>
                        <option value="30" selected>Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="180">Last 6 Months</option>
                    </select>
                    <select id="risk-analytics-heatmap-type" style="margin-left: 10px;">
                        <option value="customer" selected>Customer Heatmap</option>
                        <option value="merchant">Merchant Heatmap</option>
                    </select>
                    <button class="btn-secondary btn-sm" onclick="exportRiskHeatmapCsv()" style="margin-left: 10px;">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>
            </div>
            <div class="analytics-grid">
                <div class="chart-card wide">
                    <div class="card-header">
                        <h3 id="risk-heatmap-title">Customer Risk Heatmap</h3>
                    </div>
                    <div id="customer-risk-heatmap"></div>
                </div>
                <div class="chart-card wide">
                    <div class="card-header">
                        <h3>Risk Trends</h3>
                    </div>
                    <canvas id="risk-trends-chart"></canvas>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>False Positive Rate</span></div>
                    <div class="stat-value" id="false-positive-rate">0%</div>
                </div>
            </div>
        </div>

        <!-- Regulatory Reports View -->
        <div id="regulatory-reports-view" style="display: none;">
            <div class="page-header">
                <h1>Regulatory Reports <span class="subtitle">CTR, LCTR, IFTR</span></h1>
            </div>
            <div class="reports-grid">
                <div class="report-card">
                    <h3><i class="fas fa-file-invoice-dollar"></i> Currency Transaction Report (CTR)</h3>
                    <p>Transactions at or above $10,000 threshold</p>
                    <button class="btn-primary" onclick="generateCtr()">Generate CTR</button>
                </div>
                <div class="report-card">
                    <h3><i class="fas fa-file-invoice-dollar"></i> Large Cash Transaction Report (LCTR)</h3>
                    <p>Transactions at or above $100,000 threshold</p>
                    <button class="btn-primary" onclick="generateLctr()">Generate LCTR</button>
                </div>
                <div class="report-card">
                    <h3><i class="fas fa-globe"></i> International Funds Transfer Report (IFTR)</h3>
                    <p>Cross-border transaction reporting</p>
                    <button class="btn-primary" onclick="generateIftr()">Generate IFTR</button>
                </div>
            </div>
            <div id="regulatory-reports-results" style="margin-top: 20px;"></div>
        </div>

        <!-- SAR Reports View -->
        <div id="sar-view" style="display: none;">
            <div class="page-header">
                <h1>SAR Reports <span class="subtitle">Suspicious Activity Reporting</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="fetchSarReports()"><i class="fas fa-sync"></i> Refresh</button>
                </div>
            </div>
            <div class="table-card">
                <div class="card-header">
                    <h3><i class="fas fa-file-alt"></i> All SAR Reports</h3>
                    <div class="card-actions">
                        <select id="sarStatusFilter" onchange="filterSarReports()">
                            <option value="">All Status</option>
                            <option value="DRAFT">Draft</option>
                            <option value="PENDING_REVIEW">Pending Review</option>
                            <option value="APPROVED">Approved</option>
                            <option value="FILED">Filed</option>
                            <option value="REJECTED">Rejected</option>
                            <option value="AMENDED">Amended</option>
                        </select>
                    </div>
                </div>
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Alerts View -->
        <div id="alerts-view" style="display: none;">
            <div class="page-header">
                <h1>Alerts <span class="subtitle">Real-time Risk Mentions</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="fetchAlerts()"><i class="fas fa-sync"></i> Refresh</button>
                </div>
            </div>
            <div class="table-card">
                <div class="card-header">
                    <h3><i class="fas fa-bell"></i> All Alerts</h3>
                    <div class="card-actions">
                        <select id="alertStatusFilter" onchange="filterAlerts()">
                            <option value="">All Status</option>
                            <option value="open">Open</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                </div>
                <div class="alerts-grid">
                    <!-- Populated by JS - will be replaced with table -->
                </div>
            </div>
        </div>

        <div id="merchants-view" style="display: none;">
            <div class="page-header">
                <h1>Merchant Directory <span class="subtitle">Onboarded Entities</span></h1>
                <div class="header-actions">
                    <button class="btn-primary" onclick="openAddMerchantModal()"><i class="fas fa-plus"></i> Add
                        Merchant</button>
                </div>
            </div>
            <div class="table-card">
                <table class="data-table" id="merchants-table">
                    <thead>
                        <tr>
                            <th>Merchant</th>
                            <th>MCC Code</th>
                            <th>Risk Level</th>
                            <th>KYC Status</th>
                            <th>Contract Status</th>
                            <th>Daily Limit</th>
                            <th>Usage</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>


        <!-- Screening View -->
        <div id="screening-view" style="display: none;">
            <div class="page-header">
                <h1>AML Screening <span class="subtitle">Sanctions & PEP Check</span></h1>
            </div>
            <div class="table-card">
                <div class="screening-form">
                    <h3>Screen Name Against Sanctions</h3>
                    <form id="screening-form" onsubmit="performScreening(event)">
                        <div class="form-group">
                            <label for="entity-type">Entity Type:</label>
                            <select id="entity-type" name="entityType" required>
                                <option value="PERSON">Person</option>
                                <option value="ORGANIZATION">Organization</option>
                                <option value="VESSEL">Vessel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="screen-name">Name to Screen:</label>
                            <input type="text" id="screen-name" name="name" placeholder="Enter full name" required>
                        </div>
                        <button type="submit" class="btn-primary"><i class="fas fa-search"></i> Screen</button>
                    </form>
                </div>
                <div id="screening-results" style="margin-top: 20px; display: none;">
                    <h3>Screening Results</h3>
                    <div id="screening-results-content"></div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profile-view" style="display: none;">
            <div class="page-header">
                <h1>Admin Profile <span class="subtitle">Manage Your Account</span></h1>
            </div>
            <div class="table-card">
                <div id="profile-content">
                    <p>Loading profile...</p>
                </div>
            </div>
        </div>

        <!-- Messages View -->
        <div id="messages-view" style="display: none;">
            <div class="page-header">
                <h1>Internal Messages <span class="subtitle">Team Communication</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="fetchMessages(false)"><i class="fas fa-sync"></i>
                        Refresh</button>
                </div>
            </div>
            <div class="table-card">
                <div id="messages-content">
                    <p>Loading messages...</p>
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" style="display: none;">
            <div class="page-header">
                <h1>System Settings <span class="subtitle">Configuration & Theming</span></h1>
            </div>
            <div class="table-card">
                <div id="settings-content">
                    <p>Loading settings...</p>
                </div>
            </div>
        </div>

        <!-- Reports View -->
        <div id="reports-view" style="display: none;">
            <div class="page-header">
                <h1>Analytical Reports <span class="subtitle">Performance & Risk Insights</span></h1>
            </div>
            <div class="table-card">
                <p>Select report type to generate.</p>
            </div>
        </div>

        <!-- Audit Logs View -->
        <div id="audit-view" style="display: none;">
            <div class="page-header">
                <h1>Audit Logs <span class="subtitle">System Event History</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="resetAuditLogFilters()"><i class="fas fa-eraser"></i> Reset</button>
                    <button class="btn-secondary" onclick="exportAuditLogsCsv()"><i class="fas fa-file-csv"></i> Export CSV</button>
                    <button class="btn-primary" onclick="fetchAuditLogs()"><i class="fas fa-search"></i> Search</button>
                </div>
            </div>
            <div class="monitoring-filters audit-filters">
                <input id="auditFilterUsername" class="filter-select" type="text" placeholder="Username">
                <input id="auditFilterAction" class="filter-select" type="text" placeholder="Action Type (e.g., UPDATE)">
                <input id="auditFilterEntityType" class="filter-select" type="text" placeholder="Entity Type (e.g., CASE)">
                <input id="auditFilterEntityId" class="filter-select" type="text" placeholder="Entity ID">
                <select id="auditFilterSuccess" class="filter-select">
                    <option value="">All Results</option>
                    <option value="true">Success</option>
                    <option value="false">Failed</option>
                </select>
                <input id="auditFilterIp" class="filter-select" type="text" placeholder="IP Address">
                <input id="auditFilterSession" class="filter-select" type="text" placeholder="Session ID">
                <input id="auditFilterStart" class="filter-select" type="datetime-local" title="Start Time">
                <input id="auditFilterEnd" class="filter-select" type="datetime-local" title="End Time">
                <select id="auditFilterLimit" class="filter-select" title="Limit">
                    <option value="50">50</option>
                    <option value="100" selected>100</option>
                    <option value="250">250</option>
                    <option value="500">500</option>
                </select>
            </div>
            <div class="table-card">
                <div id="audit-logs-container">
                    <p>Loading system events...</p>
                </div>
            </div>
        </div>

        <!-- Role Management View (Moved) -->
        <div id="role-management-view" style="display: none;">
            <div class="page-header">
                <h1>Role Management <span class="subtitle">Configure Roles and Permissions</span></h1>
                <div class="header-actions">
                    <button class="btn-primary" onclick="openAddRoleModal()"><i class="fas fa-plus"></i> Create
                        Role</button>
                </div>
            </div>
            <div class="table-card">
                <table class="data-table" id="roles-table">
                    <thead>
                        <tr>
                            <th>Role Name</th>
                            <th>Description</th>
                            <th>PSP Scope</th>
                            <th>Permissions</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Transaction Monitoring - Live Monitoring View -->
        <div id="transaction-monitoring-live-view" style="display: none;">
            <div class="page-header">
                <h1>Live Transaction Monitoring <span class="subtitle">Real-time Transaction Stream</span></h1>
                <div class="header-actions">
                    <button class="btn-secondary btn-sm" onclick="toggleTransactionStream()" id="stream-toggle-btn">
                        <i class="fas fa-pause"></i> Pause Stream
                    </button>
                    <button class="btn-secondary btn-sm" onclick="loadLiveMonitoring()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="monitoring-filters">
                <select id="risk-level-filter" class="filter-select" onchange="loadLiveMonitoring()">
                    <option value="All">All Risk Levels</option>
                    <option value="LOW">Low</option>
                    <option value="MEDIUM">Medium</option>
                    <option value="HIGH">High</option>
                    <option value="CRITICAL">Critical</option>
                </select>
                <select id="decision-filter" class="filter-select" onchange="loadLiveMonitoring()">
                    <option value="All">All Decisions</option>
                    <option value="APPROVED">Approved</option>
                    <option value="MANUAL_REVIEW">Manual Review</option>
                    <option value="DECLINED">Declined</option>
                </select>
            </div>
            <div id="transactions-list" class="transactions-list">
                <div class="loading-spinner"></div>
                <p style="text-align:center;margin-top:10px;">Loading transactions...</p>
            </div>
        </div>

        <!-- Transaction Monitoring - Analytics View -->
        <div id="transaction-monitoring-analytics-view" style="display: none;">
            <div class="page-header">
                <h1>Transaction Analytics <span class="subtitle">Monitoring Insights & Metrics</span></h1>
            </div>
            <!-- Summary Cards -->
            <div class="stats-grid" id="monitoring-summary-cards">
                <div class="stat-card">
                    <div class="stat-header">
                        <span>Total Monitored</span>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="total-monitored">0</div>
                    <div class="stat-subtext">Last 24 hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span>Flagged</span>
                        <i class="fas fa-flag"></i>
                    </div>
                    <div class="stat-value" id="flagged-count">0</div>
                    <div class="stat-subtext" id="flag-rate">0% flag rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span>High Risk</span>
                        <i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i>
                    </div>
                    <div class="stat-value" id="high-risk-count">0</div>
                    <div class="stat-subtext" style="color: #e74c3c;">Requires review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <span>Blocked</span>
                        <i class="fas fa-shield-alt" style="color: #e74c3c;"></i>
                    </div>
                    <div class="stat-value" id="blocked-count">0</div>
                    <div class="stat-subtext" style="color: #e74c3c;">Auto-blocked</div>
                </div>
            </div>

            <!-- Analytics Content -->
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Risk Score Distribution</h3>
                    <div id="risk-distribution-chart">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>Top Risk Indicators</h3>
                    <div id="risk-indicators-list">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="analytics-card">
                <h3>Recent Monitoring Activity</h3>
                <div id="recent-activity-list">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <!-- Transaction Monitoring - SARs View -->
        <div id="transaction-monitoring-sars-view" style="display: none;">
            <div class="page-header">
                <h1>SARs from Monitoring <span class="subtitle">Suspicious Activity Reports</span></h1>
            </div>
            <div id="sars-list" class="sars-list">
                <div class="loading-spinner"></div>
                <p style="text-align:center;margin-top:10px;">Loading SARs...</p>
            </div>
        </div>

        <!-- Transaction Monitoring - Reports View -->
        <div id="transaction-monitoring-reports-view" style="display: none;">
            <div class="page-header">
                <h1>Monitoring Reports <span class="subtitle">Transaction Analysis & Declines</span></h1>
            </div>
            <div class="table-card">
                <h3>Merchant Decline Reports</h3>
                <p>Generate reports on declined transactions and monitoring activity.</p>
                <div class="reports-actions">
                    <button class="btn-primary" onclick="generateDeclineReport()">
                        <i class="fas fa-file-download"></i> Generate Decline Report
                    </button>
                    <button class="btn-secondary" onclick="generateMonitoringReport()">
                        <i class="fas fa-chart-bar"></i> Generate Monitoring Summary
                    </button>
                </div>
                <div id="reports-results" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Limits & AML View -->
        <div id="limits-aml-view" style="display: none;">
            <div class="page-header">
                <h1>Limits & AML Configuration <span class="subtitle">Transaction Limits & AML Rules</span></h1>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header"><span>Daily Transaction Limit</span></div>
                    <div class="stat-value" id="dailyLimit">$100,000</div>
                    <div class="stat-subtext">Per merchant default</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Monthly Volume Cap</span></div>
                    <div class="stat-value" id="monthlyLimit">$2.5M</div>
                    <div class="stat-subtext">Aggregate limit</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>High-Risk Threshold</span></div>
                    <div class="stat-value" id="riskThreshold">75</div>
                    <div class="stat-subtext">Risk score trigger</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Active Rules</span></div>
                    <div class="stat-value" id="activeRulesCount">12</div>
                    <div class="stat-subtext">AML detection rules</div>
                </div>
            </div>

            <div class="table-card">
                <div class="card-header">
                    <h3><i class="fas fa-sliders-h"></i> Transaction Limits</h3>
                    <button class="btn-primary" onclick="openAddLimitModal()"><i class="fas fa-plus"></i> Add Limit
                        Rule</button>
                </div>
                <table class="data-table" id="limits-table">
                    <thead>
                        <tr>
                            <th>Limit Type</th>
                            <th>Limit Value</th>
                            <th>Period</th>
                            <th>Applies To</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Transaction limits will be loaded dynamically -->
                    </tbody>
                </table>
            </div>

            <div class="table-card" style="margin-top: 20px;">
                <div class="card-header">
                    <h3><i class="fas fa-shield-alt"></i> AML Detection Rules</h3>
                    <button class="btn-primary" onclick="openAddAmlRuleModal()"><i class="fas fa-plus"></i> Add AML
                        Rule</button>
                </div>
                <table class="data-table" id="aml-rules-table">
                    <thead>
                        <tr>
                            <th>Rule Name</th>
                            <th>Description</th>
                            <th>Trigger Condition</th>
                            <th>Action</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Large Transaction Alert</td>
                            <td>Flag transactions above threshold</td>
                            <td>Amount > $10,000</td>
                            <td>Manual Review</td>
                            <td><span class="status-badge resolved">Active</span></td>
                            <td><button class="action-btn"><i class="fas fa-edit"></i></button></td>
                        </tr>
                        <tr>
                            <td>Velocity Check</td>
                            <td>Multiple transactions in short period</td>
                            <td>5+ txns in 10 mins</td>
                            <td>Block & Alert</td>
                            <td><span class="status-badge resolved">Active</span></td>
                            <td><button class="action-btn"><i class="fas fa-edit"></i></button></td>
                        </tr>
                        <tr>
                            <td>Sanctions Screening</td>
                            <td>Check against sanctions lists</td>
                            <td>All Transactions</td>
                            <td>Block if Match</td>
                            <td><span class="status-badge resolved">Active</span></td>
                            <td><button class="action-btn"><i class="fas fa-edit"></i></button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Case Detail View -->
        <div id="case-detail-view" style="display: none;">
            <div class="page-header">
                <div>
                    <h1 id="case-detail-title">Case Detail</h1>
                    <button class="btn-secondary" onclick="showView('cases-view')"><i class="fas fa-arrow-left"></i>
                        Back to Cases</button>
                </div>
                <div class="header-actions">
                    <button class="btn-primary" onclick="escalateCase()"><i class="fas fa-exclamation-triangle"></i>
                        Escalate</button>
                    <button class="btn-secondary" onclick="viewCaseNetwork()"><i class="fas fa-project-diagram"></i>
                        View Network</button>
                </div>
            </div>

            <div class="case-grid">
                <div class="case-info-card">
                    <h3>Case Information</h3>
                    <div id="case-info-content">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="case-tabs-card">
                    <div class="case-tabs">
                        <button class="tab-btn active" onclick="showCaseTab('timeline')">Timeline</button>
                        <button class="tab-btn" onclick="showCaseTab('activities')">Activities</button>
                        <button class="tab-btn" onclick="showCaseTab('documents')">Documents</button>
                    </div>

                    <div id="case-timeline-tab" class="case-tab-content active">
                        <div id="case-timeline-content" class="timeline-container">
                        </div>
                    </div>

                    <div id="case-activities-tab" class="case-tab-content">
                        <div id="case-activities-content" class="activities-container">
                        </div>
                    </div>

                    <div id="case-documents-tab" class="case-tab-content">
                        <p>No documents attached.</p>
                        <button class="btn-secondary"><i class="fas fa-upload"></i> Upload Document</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Calendar View -->
        <div id="compliance-calendar-view" style="display: none;">
            <div class="page-header">
                <h1>Compliance Calendar <span class="subtitle">Regulatory Filing Deadlines</span></h1>
                <div class="header-actions">
                    <button class="btn-primary" onclick="openCreateDeadlineModal()"><i class="fas fa-plus"></i> Add
                        Deadline</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header"><span>Upcoming Deadlines</span></div>
                    <div class="stat-value" id="upcomingDeadlinesCount">0</div>
                    <div class="stat-subtext">Next 30 days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Overdue</span></div>
                    <div class="stat-value" id="overdueDeadlinesCount" style="color: #e74c3c;">0</div>
                    <div class="stat-subtext">Requires immediate attention</div>
                </div>
            </div>

            <div class="table-card" style="margin-top: 20px;">
                <div class="card-header calendar-card-header">
                    <h3><i class="fas fa-calendar"></i> Calendar View</h3>
                    <div class="header-actions calendar-nav">
                        <button class="btn-secondary btn-sm" onclick="prevCalendarMonth()" title="Previous Month">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="calendarMonthLabel" class="calendar-month-label"></span>
                        <button class="btn-secondary btn-sm" onclick="nextCalendarMonth()" title="Next Month">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div id="compliance-calendar-grid" class="calendar-grid">
                    <!-- Populated by JS -->
                </div>
                <div id="calendar-day-details" class="calendar-day-details" style="display:none;">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="table-card">
                <div class="card-header">
                    <h3><i class="fas fa-calendar-alt"></i> Upcoming Deadlines</h3>
                </div>
                <div id="upcoming-deadlines-list" class="deadlines-list">
                    <p>No upcoming deadlines</p>
                </div>
            </div>

            <div class="table-card" style="margin-top: 20px;">
                <div class="card-header">
                    <h3><i class="fas fa-exclamation-circle"></i> Overdue Deadlines</h3>
                </div>
                <div id="overdue-deadlines-list" class="deadlines-list">
                    <p>No overdue deadlines</p>
                </div>
            </div>
        </div>

        <!-- Regulatory Reports View -->
        <div id="regulatory-reports-view" style="display: none;">
            <div class="page-header">
                <h1>Regulatory Reports <span class="subtitle">CTR, LCTR, IFTR</span></h1>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="report-card-header">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Currency Transaction Report (CTR)</h3>
                    </div>
                    <p>Transactions at or above $10,000 threshold</p>
                    <button class="btn-primary" onclick="generateCtr()"><i class="fas fa-file-alt"></i> Generate
                        CTR</button>
                </div>
                <div class="stat-card">
                    <div class="report-card-header">
                        <h3><i class="fas fa-money-bill-wave"></i> Large Cash Transaction Report (LCTR)</h3>
                    </div>
                    <p>Transactions at or above $100,000 threshold</p>
                    <button class="btn-primary" onclick="generateLctr()"><i class="fas fa-file-alt"></i> Generate
                        LCTR</button>
                </div>
                <div class="stat-card">
                    <div class="report-card-header">
                        <h3><i class="fas fa-globe"></i> International Funds Transfer Report (IFTR)</h3>
                    </div>
                    <p>Cross-border transaction reporting</p>
                    <button class="btn-primary" onclick="generateIftr()"><i class="fas fa-file-alt"></i> Generate
                        IFTR</button>
                </div>
            </div>

            <div id="regulatory-reports-results" class="table-card" style="margin-top: 20px;">
                <!-- Report results populated by JS -->
            </div>
        </div>

        <!-- Reports View -->
        <div id="reports-view" style="display: none;">
            <div class="page-header">
                <h1>Analytical Reports <span class="subtitle">Performance & Risk Insights</span></h1>
                <div class="header-actions">
                    <button class="btn-primary" onclick="generateAnalyticsReport()"><i class="fas fa-chart-line"></i>
                        Generate Report</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header"><span>Total Reports</span></div>
                    <div class="stat-value" id="totalReportsCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Generated Today</span></div>
                    <div class="stat-value" id="todayReportsCount">0</div>
                </div>
            </div>

            <div class="table-card">
                <div class="card-header">
                    <h3><i class="fas fa-list"></i> Recent Reports</h3>
                    <button class="btn-secondary" onclick="fetchReports()"><i class="fas fa-sync"></i> Refresh</button>
                </div>
                <table class="data-table" id="reports-table">
                    <thead>
                        <tr>
                            <th>Report ID</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Risk Analytics View -->
        <div id="risk-analytics-view" style="display: none;">
            <div class="page-header">
                <h1>Risk Analytics <span class="subtitle">Risk Assessment Dashboard</span></h1>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header"><span>High Risk Merchants</span></div>
                    <div class="stat-value" id="highRiskMerchantCount" style="color: #e74c3c;">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Average Risk Score</span></div>
                    <div class="stat-value" id="avgRiskScore">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span>Risk Alerts Today</span></div>
                    <div class="stat-value" id="riskAlertsToday">0</div>
                </div>
            </div>

            <div id="risk-analytics-content">
                <!-- Populated by JS -->
            </div>
        </div>
    </main>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditUserModal()">&times;</span>
            <h2>Edit User</h2>
            <form id="editUserForm">
                <input type="hidden" name="userId" id="editUserId">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" name="username" id="editUsername" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" id="editEmail" required>
                </div>
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" name="firstName" id="editFirstName">
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" name="lastName" id="editLastName">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" id="editPassword" placeholder="Leave blank to keep current password" disabled>
                    <small style="color: #999; font-size: 0.85em;">Password changes are not supported in edit mode. Use the user management reset password feature.</small>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select name="roleId" id="editUserRoleSelect" required>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>PSP</label>
                    <select name="pspId" id="editUserPspSelect">
                        <option value="">System (Global)</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="enabled" id="editUserEnabled"> Enabled
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" class="btn-secondary" onclick="closeEditUserModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddUserModal()">&times;</span>
            <h2>Add New User</h2>
            <form id="addUserForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" name="firstName">
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" name="lastName">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select name="roleId" id="userRoleSelect" required>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>PSP</label>
                    <select name="pspId" id="userPspSelect">
                        <option value="">System (Global)</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <button type="submit" class="btn-primary">Create User</button>
            </form>
        </div>
    </div>

    <!-- Add Role Modal -->
    <div id="addRoleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddRoleModal()">&times;</span>
            <h2>Create New Role</h2>
            <form id="addRoleForm">
                <div class="form-group">
                    <label>Role Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description"></textarea>
                </div>
                <div class="form-group">
                    <label>PSP Scope</label>
                    <select name="pspId" id="rolePspSelect">
                        <option value="">System (Global)</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Permissions</label>
                    <div id="permissionsCheckboxes" class="checkbox-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <button type="submit" class="btn-primary">Create Role</button>
            </form>
        </div>
    </div>

    <!-- Edit Role Modal -->
    <div id="editRoleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditRoleModal()">&times;</span>
            <h2>Edit Role</h2>
            <form id="editRoleForm">
                <input type="hidden" name="roleId" id="editRoleId">
                <div class="form-group">
                    <label>Role Name</label>
                    <input type="text" name="name" id="editRoleName" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" id="editRoleDescription"></textarea>
                </div>
                <!-- Permissions will be handled via separate management or simple list for now -->
                <div class="form-group">
                    <p><em>Permission editing not yet fully implemented in this modal.</em></p>
                </div>
                <button type="submit" class="btn-primary">Save Role Changes</button>
            </form>
        </div>
    </div>

    <!-- Add Merchant Modal -->
    <div id="addMerchantModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddMerchantModal()">&times;</span>
            <h2>Add New Merchant</h2>
            <form id="addMerchantForm">
                <div class="form-group">
                    <label>Legal Name</label>
                    <input type="text" name="legalName" required placeholder="Company Legal Name">
                </div>
                <div class="form-group">
                    <label>Trading Name</label>
                    <input type="text" name="tradingName" placeholder="Trading/Display Name">
                </div>
                <div class="form-group">
                    <label>Contact Email</label>
                    <input type="email" name="contactEmail" required placeholder="merchant@example.com">
                </div>
                <div class="form-group">
                    <label>MCC Code</label>
                    <input type="text" name="mcc" placeholder="e.g. 5411">
                </div>
                <div class="form-group">
                    <label>Business Type</label>
                    <select name="businessType">
                        <option value="RETAIL">Retail</option>
                        <option value="ECOMMERCE">E-Commerce</option>
                        <option value="SERVICES">Services</option>
                        <option value="FOOD_BEVERAGE">Food & Beverage</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Daily Limit (KES)</label>
                    <input type="number" name="dailyLimit" value="100000" min="0">
                </div>
                <div class="form-group">
                    <label>Risk Level</label>
                    <select name="riskLevel">
                        <option value="LOW">Low</option>
                        <option value="MEDIUM" selected>Medium</option>
                        <option value="HIGH">High</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Create Merchant</button>
            </form>
        </div>
    </div>

    <!-- View Merchant Modal -->
    <div id="viewMerchantModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeViewMerchantModal()">&times;</span>
            <h2>Merchant Details</h2>
            <div id="viewMerchantContent">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </div>

    <!-- Edit Merchant Modal -->
    <div id="editMerchantModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditMerchantModal()">&times;</span>
            <h2>Edit Merchant</h2>
            <form id="editMerchantForm">
                <input type="hidden" name="merchantId" id="editMerchantId">
                <div class="form-group">
                    <label>Legal Name</label>
                    <input type="text" name="legalName" id="editMerchantLegalName" required>
                </div>
                <div class="form-group">
                    <label>Trading Name</label>
                    <input type="text" name="tradingName" id="editMerchantTradingName">
                </div>
                <div class="form-group">
                    <label>Contact Email</label>
                    <input type="email" name="contactEmail" id="editMerchantEmail" required>
                </div>
                <div class="form-group">
                    <label>Business Type</label>
                    <select name="businessType" id="editMerchantBusinessType">
                        <option value="RETAIL">Retail</option>
                        <option value="ECOMMERCE">E-Commerce</option>
                        <option value="SERVICES">Services</option>
                        <option value="FOOD_BEVERAGE">Food & Beverage</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select name="status" id="editMerchantStatus">
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                        <option value="SUSPENDED">Suspended</option>
                        <option value="TERMINATED">Terminated</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Update Merchant</button>
            </form>
        </div>
    </div>

    <!-- Create Deadline Modal -->
    <div id="createDeadlineModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateDeadlineModal()">&times;</span>
            <h2>Add Compliance Deadline</h2>
            <form id="createDeadlineForm">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" required placeholder="e.g. SAR Filing for CASE-123">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" placeholder="Additional details..."></textarea>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" name="dueDate" required>
                </div>
                <div class="form-group">
                    <label>Jurisdiction</label>
                    <input type="text" name="jurisdiction" placeholder="e.g. US, UK, EU" value="US">
                </div>
                <button type="submit" class="btn-primary">Save Deadline</button>
            </form>
        </div>
    </div>

    <!-- Create Case Queue Modal -->
    <div id="createQueueModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateQueueModal()">&times;</span>
            <h2>Create Case Queue</h2>
            <form id="createQueueForm">
                <div class="form-group">
                    <label>Queue Name</label>
                    <input type="text" name="queueName" required placeholder="e.g. High Priority Queue">
                </div>
                <div class="form-group">
                    <label>Target Role</label>
                    <select name="targetRole" required>
                        <option value="ANALYST">ANALYST</option>
                        <option value="INVESTIGATOR">INVESTIGATOR</option>
                        <option value="COMPLIANCE_OFFICER">COMPLIANCE_OFFICER</option>
                        <option value="MLRO">MLRO</option>
                        <option value="SCREENING_ANALYST">SCREENING_ANALYST</option>
                        <option value="CASE_MANAGER">CASE_MANAGER</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Minimum Priority</label>
                    <select name="minPriority">
                        <option value="">None</option>
                        <option value="LOW">LOW</option>
                        <option value="MEDIUM" selected>MEDIUM</option>
                        <option value="HIGH">HIGH</option>
                        <option value="CRITICAL">CRITICAL</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Max Queue Size</label>
                    <input type="number" name="maxQueueSize" min="1" placeholder="Optional">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="autoAssign"> Auto-assign cases from this queue
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="enabled" checked> Enabled
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn-primary">Create Queue</button>
                    <button type="button" class="btn-secondary" onclick="closeCreateQueueModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Transaction Limit Modal -->
    <div id="editTransactionLimitModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditTransactionLimitModal()">&times;</span>
            <h2>Edit Transaction Limit</h2>
            <form id="editTransactionLimitForm">
                <input type="hidden" id="editLimitId" name="id">
                <div class="form-group">
                    <label>Limit Name <span style="color: #e74c3c;">*</span></label>
                    <input type="text" id="editLimitName" name="name" required placeholder="e.g. Daily Transaction Limit">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editLimitDescription" name="description" placeholder="Applies to all merchants"></textarea>
                </div>
                <div class="form-group">
                    <label>Limit Type <span style="color: #e74c3c;">*</span></label>
                    <select id="editLimitType" name="limitType" required>
                        <option value="VOLUME">Volume (Amount)</option>
                        <option value="COUNT">Count (Number of transactions)</option>
                        <option value="VELOCITY">Velocity (Rate)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Limit Value <span style="color: #e74c3c;">*</span></label>
                    <input type="number" id="editLimitValue" name="limitValue" required min="0" step="0.01" placeholder="e.g. 100000">
                    <small style="color: #94a3b8; font-size: 0.85em;">Enter amount in cents for VOLUME type, or count for COUNT type</small>
                </div>
                <div class="form-group">
                    <label>Period <span style="color: #e74c3c;">*</span></label>
                    <select id="editLimitPeriod" name="period" required>
                        <option value="MINUTE">Per Minute</option>
                        <option value="HOUR">Per Hour</option>
                        <option value="DAY" selected>Per Day (24 Hours)</option>
                        <option value="WEEK">Per Week (7 Days)</option>
                        <option value="MONTH">Per Month (30 Days)</option>
                        <option value="TRANSACTION">Per Transaction</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status <span style="color: #e74c3c;">*</span></label>
                    <select id="editLimitStatus" name="status" required>
                        <option value="ACTIVE" selected>Active</option>
                        <option value="INACTIVE">Inactive</option>
                        <option value="SUSPENDED">Suspended</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" class="btn-secondary" onclick="closeEditTransactionLimitModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Widget -->
    <div class="settings-widget"
        onclick="document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.querySelectorAll('[data-view=settings]')[0].classList.add('active'); document.querySelectorAll('[id$=-view]').forEach(v => v.style.display = 'none'); document.getElementById('settings-view').style.display = 'block'; if(window.fetchSettings) fetchSettings();"
        title="Settings">
        <i class="fas fa-cog"></i>
    </div>

    <script src="js/api-interceptor.js"></script>
    <script src="js/session-manager.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/case-management.js"></script>
    <script src="js/risk-analytics.js"></script>
    <script src="js/compliance-calendar.js"></script>
    <script src="js/regulatory-reports.js"></script>
    <script src="js/limits-aml-management.js"></script>
    <script src="js/transaction-monitoring.js"></script>
</body>

</html>